<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Paper Analysis Viewer</title>
    <style>
        /* Julie Zhou Design Principles Applied */
        
        /* Typography & Spacing earn trust */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --background: #ffffff;
            --surface: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --transition: all 0.2s ease-in-out;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--background);
        }
        
        /* Content drives layout */
        .app-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Sidebar - Paper List */
        .sidebar {
            background: var(--surface);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 24px 20px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--background);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .settings-button {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 8px;
            border-radius: 4px;
            transition: var(--transition);
        }
        
        .settings-button:hover {
            background: var(--surface);
            color: var(--text-primary);
        }
        
        .sidebar-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .sidebar-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        /* Search & Filter - Thoughtful defaults */
        .search-section {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--background);
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .filter-section {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .filter-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .filter-button {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 12px;
            background: var(--background);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .filter-button:hover {
            background: var(--surface);
            border-color: var(--primary-color);
        }
        
        .filter-button.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Paper List */
        .paper-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .paper-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }
        
        .paper-item:hover {
            background: var(--background);
        }
        
        .paper-item.selected {
            background: var(--primary-color);
            color: white;
        }
        
        .paper-item.selected .paper-meta {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .paper-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        
        .paper-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .priority-badge {
            background: var(--warning-color);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        /* Main Content Area */
        .main-content {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Zero state - first-class citizen */
        .zero-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px;
            text-align: center;
        }
        
        .zero-state-icon {
            width: 64px;
            height: 64px;
            background: var(--surface);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            font-size: 24px;
            color: var(--text-secondary);
        }
        
        .zero-state-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .zero-state-description {
            font-size: 14px;
            color: var(--text-secondary);
            max-width: 400px;
        }
        
        /* Loading state - first-class citizen */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--surface);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        /* Error state - first-class citizen */
        .error-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px;
            text-align: center;
        }
        
        .error-icon {
            width: 64px;
            height: 64px;
            background: var(--error-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            color: white;
            font-size: 24px;
        }
        
        .error-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--error-color);
        }
        
        .error-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }
        
        .retry-button {
            padding: 8px 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .retry-button:hover {
            background: #1d4ed8;
        }
        
        /* Paper Content */
        .paper-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .paper-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border);
            background: var(--background);
        }
        
        .paper-header-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .paper-header-meta {
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
            overflow-x: auto;
        }
        
        .tab-button {
            padding: 16px 24px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: var(--transition);
            white-space: nowrap;
            border-bottom: 2px solid transparent;
        }
        
        .tab-button:hover {
            color: var(--text-primary);
            background: var(--background);
        }
        
        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: var(--background);
        }
        
        /* Tab Content */
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }
        
        .tab-content h1, .tab-content h2, .tab-content h3 {
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .tab-content h1 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .tab-content h2 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .tab-content h3 {
            font-size: 16px;
            font-weight: 600;
        }
        
        .tab-content p {
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .tab-content ul, .tab-content ol {
            margin-bottom: 16px;
            padding-left: 20px;
        }
        
        .tab-content li {
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .tab-content pre {
            background: var(--surface);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 16px;
            font-size: 14px;
            border: 1px solid var(--border);
        }
        
        .tab-content code {
            background: var(--surface);
            padding: 2px 4px;
            border-radius: 4px;
            font-size: 13px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .sidebar {
                order: 2;
                height: 300px;
            }
            
            .main-content {
                order: 1;
            }
        }
        
        /* WCAG AA Compliance */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --border: #000000;
                --text-secondary: #000000;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Settings Modal */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }
        
        .settings-content {
            background: var(--background);
            border-radius: 12px;
            padding: 32px;
            max-width: 480px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
        }
        
        .settings-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }
        
        .settings-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }
        
        .close-button:hover {
            background: var(--surface);
            color: var(--text-primary);
        }
        
        .settings-section {
            margin-bottom: 24px;
        }
        
        .settings-section-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .settings-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .settings-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--background);
            transition: var(--transition);
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        }
        
        .settings-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .settings-input[type="password"] {
            letter-spacing: 2px;
        }
        
        .provider-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .provider-button {
            padding: 8px 16px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--background);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }
        
        .provider-button:hover {
            background: var(--surface);
            border-color: var(--primary-color);
        }
        
        .provider-button.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .settings-footer {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }
        
        .settings-actions {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
            margin-top: 16px;
        }
        
        .save-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .save-button:hover {
            background: #1d4ed8;
        }
        
        .save-button:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
        }
        
        .analyze-button {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .analyze-button:hover {
            background: #059669;
        }
        
        .analyze-button:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
        }
        
        .analyze-button.running {
            background: var(--warning-color);
        }
        
        .analyze-button.running:hover {
            background: #d97706;
        }
        
        .settings-status {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .settings-status.success {
            color: var(--success-color);
        }
        
        .settings-status.error {
            color: var(--error-color);
        }
        
        .key-preview {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        }
        
        .security-notice {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .security-notice-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .security-notice-text {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">AI Paper Analysis</h1>
                <p class="sidebar-subtitle">Comprehensive research insights</p>
                <button class="settings-button" onclick="openSettings()" aria-label="Settings">
                    ‚öôÔ∏è
                </button>
            </div>
            
            <div class="search-section">
                <input 
                    type="text" 
                    class="search-input" 
                    placeholder="Search papers..."
                    id="searchInput"
                    aria-label="Search papers"
                >
            </div>
            
            <div class="filter-section">
                <div class="filter-label">Filter by Category</div>
                <div class="filter-buttons" id="filterButtons">
                    <button class="filter-button active" data-filter="all">All</button>
                    <button class="filter-button" data-filter="priority">Priority</button>
                    <button class="filter-button" data-filter="foundational">Foundational</button>
                    <button class="filter-button" data-filter="applications">Applications</button>
                    <button class="filter-button" data-filter="benchmarks">Benchmarks</button>
                </div>
            </div>
            
            <div class="paper-list" id="paperList">
                <!-- Paper items will be populated here -->
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- States: Zero, Loading, Error, Success -->
            <div class="zero-state" id="zeroState">
                <div class="zero-state-icon">üìÑ</div>
                <h2 class="zero-state-title">Select a Paper</h2>
                <p class="zero-state-description">
                    Choose a paper from the sidebar to view its comprehensive analysis including key insights, 
                    technical summaries, and implementation details.
                </p>
            </div>
            
            <div class="loading-state hidden" id="loadingState">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading paper analysis...</p>
            </div>
            
            <div class="error-state hidden" id="errorState">
                <div class="error-icon">‚ö†Ô∏è</div>
                <h2 class="error-title">Failed to Load Paper</h2>
                <p class="error-description">
                    We encountered an error while loading the paper analysis. Please try again.
                </p>
                <button class="retry-button" onclick="retryLoading()">Retry</button>
            </div>
            
            <div class="paper-content hidden" id="paperContent">
                <div class="paper-header">
                    <h1 class="paper-header-title" id="paperTitle">Paper Title</h1>
                    <div class="paper-header-meta">
                        <span id="paperYear">2024</span>
                        <span id="paperSection">Section</span>
                        <span id="paperUrl">
                            <a href="#" target="_blank" rel="noopener noreferrer">View Original</a>
                        </span>
                    </div>
                </div>
                
                <div class="tab-navigation">
                    <button class="tab-button active" data-tab="precision" id="precisionTab">
                        Precision Analysis
                    </button>
                    <button class="tab-button" data-tab="karpathy" id="karpathyTab">
                        Karpathy Style
                    </button>
                    <button class="tab-button" data-tab="swyx" id="swyxTab">
                        Swyx Style
                    </button>
                    <button class="tab-button" data-tab="elad" id="eladTab">
                        Elad Gil Style
                    </button>
                    <button class="tab-button" data-tab="pseudocode" id="pseudocodeTab">
                        Pseudocode
                    </button>
                </div>
                
                <div class="tab-content" id="tabContent">
                    <!-- Content will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Settings Modal -->
        <div class="settings-modal hidden" id="settingsModal">
            <div class="settings-content">
                <div class="settings-header">
                    <h2 class="settings-title">API Settings</h2>
                    <button class="close-button" onclick="closeSettings()" aria-label="Close">√ó</button>
                </div>
                
                <div class="settings-section">
                    <div class="settings-section-title">AI Provider</div>
                    <div class="settings-description">Choose your preferred AI analysis provider</div>
                    <div class="provider-selector">
                        <button class="provider-button active" data-provider="openai" onclick="selectProvider('openai')">
                            OpenAI
                        </button>
                        <button class="provider-button" data-provider="anthropic" onclick="selectProvider('anthropic')">
                            Anthropic
                        </button>
                        <button class="provider-button" data-provider="local" onclick="selectProvider('local')">
                            Local LLM
                        </button>
                    </div>
                </div>
                
                <div class="settings-section" id="apiKeySection">
                    <div class="settings-section-title">API Key</div>
                    <div class="settings-description">
                        Enter your API key to enable real-time paper analysis. Keys are stored locally and never shared.
                    </div>
                    <input 
                        type="password" 
                        class="settings-input" 
                        id="apiKeyInput"
                        placeholder="sk-..."
                        autocomplete="off"
                    >
                    <div class="key-preview" id="keyPreview"></div>
                </div>
                
                <div class="settings-section" id="localEndpointSection" style="display: none;">
                    <div class="settings-section-title">Local Endpoint</div>
                    <div class="settings-description">
                        Enter the URL for your local LLM server (e.g., Ollama, LM Studio)
                    </div>
                    <input 
                        type="text" 
                        class="settings-input" 
                        id="endpointInput"
                        placeholder="http://localhost:11434"
                        autocomplete="off"
                    >
                </div>
                
                <div class="security-notice">
                    <div class="security-notice-title">
                        üîí Privacy & Security
                    </div>
                    <div class="security-notice-text">
                        ‚Ä¢ API keys are stored locally in your browser only<br>
                        ‚Ä¢ Keys are never transmitted to our servers<br>
                        ‚Ä¢ Clear your browser data to remove stored keys<br>
                        ‚Ä¢ Always use API keys with limited scope and spending limits
                    </div>
                </div>
                
                <div class="settings-footer">
                    <div class="settings-status" id="settingsStatus">
                        Not configured
                    </div>
                    <div class="settings-actions">
                        <button class="save-button" onclick="saveSettings()" id="saveButton">
                            Save Settings
                        </button>
                        <button class="analyze-button hidden" onclick="runAnalysis()" id="analyzeButton">
                            üîÑ Re-analyze Papers
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let currentPaper = null;
        let currentTab = 'precision';
        let papers = [];
        let filteredPapers = [];
        let currentFilter = 'all';
        let currentProvider = 'openai';
        let apiSettings = {
            provider: 'openai',
            apiKey: '',
            endpoint: 'http://localhost:11434'
        };
        
        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const filterButtons = document.getElementById('filterButtons');
        const paperList = document.getElementById('paperList');
        const zeroState = document.getElementById('zeroState');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const paperContent = document.getElementById('paperContent');
        const paperTitle = document.getElementById('paperTitle');
        const paperYear = document.getElementById('paperYear');
        const paperSection = document.getElementById('paperSection');
        const paperUrl = document.getElementById('paperUrl');
        const tabContent = document.getElementById('tabContent');
        const tabButtons = document.querySelectorAll('.tab-button');
        
        // Initialize Application
        async function init() {
            try {
                showLoading();
                await loadPapers();
                renderPapers();
                setupEventListeners();
                showZeroState();
            } catch (error) {
                console.error('Initialization error:', error);
                showError();
            }
        }
        
        // Load Papers Data
        async function loadPapers() {
            try {
                const response = await fetch('paper_analysis/index.json');
                const data = await response.json();
                papers = data.papers || [];
                filteredPapers = [...papers];
            } catch (error) {
                console.error('Failed to load papers:', error);
                // Fallback to mock data for demo
                papers = generateMockPapers();
                filteredPapers = [...papers];
            }
        }
        
        // Generate Mock Papers for Demo
        function generateMockPapers() {
            return [
                {
                    title: "Attention Is All You Need",
                    section: "Foundational Modelling",
                    year: "2017",
                    priority: true,
                    url: "https://arxiv.org/pdf/1706.03762",
                    directory: "attention-is-all-you-need"
                },
                {
                    title: "Language Models are Few-Shot Learners",
                    section: "Foundational Modelling",
                    year: "2020",
                    priority: true,
                    url: "https://arxiv.org/pdf/2005.14165",
                    directory: "language-models-are-few-shot-learners"
                },
                {
                    title: "Chain of Thought Prompting",
                    section: "Planning/Reasoning",
                    year: "2022",
                    priority: true,
                    url: "https://arxiv.org/pdf/2201.11903",
                    directory: "chain-of-thought-prompting"
                }
            ];
        }
        
        // Render Papers List
        function renderPapers() {
            paperList.innerHTML = '';
            
            filteredPapers.forEach(paper => {
                const paperItem = document.createElement('div');
                paperItem.className = 'paper-item';
                paperItem.dataset.paperId = paper.directory;
                
                paperItem.innerHTML = `
                    <div class="paper-title">${paper.title}</div>
                    <div class="paper-meta">
                        <span>${paper.year}</span>
                        <span>${paper.section}</span>
                        ${paper.priority ? '<span class="priority-badge">Priority</span>' : ''}
                    </div>
                `;
                
                paperItem.addEventListener('click', () => selectPaper(paper));
                paperList.appendChild(paperItem);
            });
        }
        
        // Select Paper
        async function selectPaper(paper) {
            currentPaper = paper;
            
            // Update UI selection
            document.querySelectorAll('.paper-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            const selectedItem = document.querySelector(`[data-paper-id="${paper.directory}"]`);
            if (selectedItem) {
                selectedItem.classList.add('selected');
            }
            
            // Load paper content
            await loadPaperContent(paper);
        }
        
        // Load Paper Content
        async function loadPaperContent(paper) {
            try {
                showLoading();
                
                // Update paper header
                paperTitle.textContent = paper.title;
                paperYear.textContent = paper.year;
                paperSection.textContent = paper.section;
                paperUrl.innerHTML = `<a href="${paper.url}" target="_blank" rel="noopener noreferrer">View Original</a>`;
                
                // Reset to first tab
                currentTab = 'precision';
                updateTabSelection();
                
                // Load tab content
                await loadTabContent(paper, currentTab);
                
                showPaperContent();
                
            } catch (error) {
                console.error('Failed to load paper content:', error);
                showError();
            }
        }
        
        // Load Tab Content
        async function loadTabContent(paper, tab) {
            try {
                const fileName = getTabFileName(tab);
                const response = await fetch(`paper_analysis/${paper.directory}/${fileName}`);
                
                if (!response.ok) {
                    throw new Error(`Failed to load ${fileName}`);
                }
                
                const content = await response.text();
                
                // Convert markdown to HTML (simplified)
                const htmlContent = convertMarkdownToHtml(content);
                tabContent.innerHTML = htmlContent;
                
            } catch (error) {
                console.error('Failed to load tab content:', error);
                tabContent.innerHTML = `
                    <div class="error-message">
                        <h3>Content Not Available</h3>
                        <p>This analysis is not yet available for this paper.</p>
                    </div>
                `;
            }
        }
        
        // Get Tab File Name
        function getTabFileName(tab) {
            const fileMap = {
                'precision': 'stage_1_analysis.md',
                'karpathy': 'stage_2_analysis.md',
                'swyx': 'stage_3_analysis.md',
                'elad': 'stage_4_analysis.md',
                'pseudocode': 'pseudocode.md'
            };
            return fileMap[tab] || 'stage_1_analysis.md';
        }
        
        // Simple Markdown to HTML Converter
        function convertMarkdownToHtml(markdown) {
            return markdown
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/^- (.*$)/gm, '<li>$1</li>')
                .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^(.*)$/gm, '<p>$1</p>')
                .replace(/<p><\/p>/g, '')
                .replace(/<p>(<h[1-6]>.*<\/h[1-6]>)<\/p>/g, '$1')
                .replace(/<p>(<ul>.*<\/ul>)<\/p>/g, '$1')
                .replace(/<p>(<pre>.*<\/pre>)<\/p>/g, '$1');
        }
        
        // Setup Event Listeners
        function setupEventListeners() {
            // Search functionality
            searchInput.addEventListener('input', debounce(handleSearch, 300));
            
            // Filter buttons
            filterButtons.addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-button')) {
                    handleFilter(e.target.dataset.filter);
                }
            });
            
            // Tab navigation
            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const tab = e.target.dataset.tab;
                    if (tab && currentPaper) {
                        switchTab(tab);
                    }
                });
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', handleKeyboard);
        }
        
        // Handle Search
        function handleSearch(e) {
            const query = e.target.value.toLowerCase();
            applyFilters(query, currentFilter);
        }
        
        // Handle Filter
        function handleFilter(filter) {
            currentFilter = filter;
            
            // Update filter button states
            filterButtons.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeButton = filterButtons.querySelector(`[data-filter="${filter}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
            
            const query = searchInput.value.toLowerCase();
            applyFilters(query, filter);
        }
        
        // Apply Filters
        function applyFilters(searchQuery, categoryFilter) {
            filteredPapers = papers.filter(paper => {
                const matchesSearch = !searchQuery || 
                    paper.title.toLowerCase().includes(searchQuery) ||
                    paper.section.toLowerCase().includes(searchQuery);
                
                const matchesCategory = categoryFilter === 'all' ||
                    (categoryFilter === 'priority' && paper.priority) ||
                    paper.section.toLowerCase().includes(categoryFilter.toLowerCase());
                
                return matchesSearch && matchesCategory;
            });
            
            renderPapers();
        }
        
        // Switch Tab
        async function switchTab(tab) {
            if (tab === currentTab) return;
            
            currentTab = tab;
            updateTabSelection();
            
            if (currentPaper) {
                await loadTabContent(currentPaper, tab);
            }
        }
        
        // Update Tab Selection
        function updateTabSelection() {
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`[data-tab="${currentTab}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
        }
        
        // Handle Keyboard Navigation
        function handleKeyboard(e) {
            // Escape key to clear selection
            if (e.key === 'Escape') {
                showZeroState();
                document.querySelectorAll('.paper-item').forEach(item => {
                    item.classList.remove('selected');
                });
                currentPaper = null;
            }
            
            // Tab navigation with arrow keys
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                if (currentPaper && document.activeElement.classList.contains('tab-button')) {
                    e.preventDefault();
                    const tabs = Array.from(tabButtons);
                    const currentIndex = tabs.findIndex(tab => tab.classList.contains('active'));
                    
                    let newIndex;
                    if (e.key === 'ArrowLeft') {
                        newIndex = currentIndex > 0 ? currentIndex - 1 : tabs.length - 1;
                    } else {
                        newIndex = currentIndex < tabs.length - 1 ? currentIndex + 1 : 0;
                    }
                    
                    const newTab = tabs[newIndex];
                    newTab.focus();
                    switchTab(newTab.dataset.tab);
                }
            }
        }
        
        // State Management
        function showZeroState() {
            hideAllStates();
            zeroState.classList.remove('hidden');
        }
        
        function showLoading() {
            hideAllStates();
            loadingState.classList.remove('hidden');
        }
        
        function showError() {
            hideAllStates();
            errorState.classList.remove('hidden');
        }
        
        function showPaperContent() {
            hideAllStates();
            paperContent.classList.remove('hidden');
        }
        
        function hideAllStates() {
            zeroState.classList.add('hidden');
            loadingState.classList.add('hidden');
            errorState.classList.add('hidden');
            paperContent.classList.add('hidden');
        }
        
        // Retry Loading
        function retryLoading() {
            if (currentPaper) {
                loadPaperContent(currentPaper);
            } else {
                init();
            }
        }
        
        // Utility Functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Add hidden class utility
        const style = document.createElement('style');
        style.textContent = '.hidden { display: none !important; }';
        document.head.appendChild(style);
        
        // Settings Management
        function openSettings() {
            loadSettings();
            document.getElementById('settingsModal').classList.remove('hidden');
        }
        
        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }
        
        function selectProvider(provider) {
            currentProvider = provider;
            
            // Update provider buttons
            document.querySelectorAll('.provider-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-provider="${provider}"]`).classList.add('active');
            
            // Show/hide relevant sections
            const apiKeySection = document.getElementById('apiKeySection');
            const localEndpointSection = document.getElementById('localEndpointSection');
            
            if (provider === 'local') {
                apiKeySection.style.display = 'none';
                localEndpointSection.style.display = 'block';
            } else {
                apiKeySection.style.display = 'block';
                localEndpointSection.style.display = 'none';
            }
            
            updateSettingsStatus();
        }
        
        function saveSettings() {
            const apiKey = document.getElementById('apiKeyInput').value;
            const endpoint = document.getElementById('endpointInput').value;
            
            apiSettings = {
                provider: currentProvider,
                apiKey: currentProvider !== 'local' ? apiKey : '',
                endpoint: currentProvider === 'local' ? endpoint : ''
            };
            
            // Save to localStorage
            try {
                localStorage.setItem('aiPaperAnalysis_settings', JSON.stringify(apiSettings));
                showSettingsStatus('Settings saved successfully', 'success');
                
                // Update interface
                updateSettingsStatus();
                
                // Close modal after short delay
                setTimeout(() => {
                    closeSettings();
                }, 1000);
                
            } catch (error) {
                showSettingsStatus('Failed to save settings', 'error');
            }
        }
        
        function loadSettings() {
            try {
                const saved = localStorage.getItem('aiPaperAnalysis_settings');
                if (saved) {
                    apiSettings = JSON.parse(saved);
                    currentProvider = apiSettings.provider;
                    
                    // Update UI
                    selectProvider(currentProvider);
                    document.getElementById('apiKeyInput').value = apiSettings.apiKey || '';
                    document.getElementById('endpointInput').value = apiSettings.endpoint || 'http://localhost:11434';
                    updateKeyPreview();
                }
            } catch (error) {
                console.error('Failed to load settings:', error);
            }
            
            updateSettingsStatus();
        }
        
        function updateSettingsStatus() {
            const statusEl = document.getElementById('settingsStatus');
            const saveBtn = document.getElementById('saveButton');
            const analyzeBtn = document.getElementById('analyzeButton');
            
            let isConfigured = false;
            let statusText = 'Not configured';
            
            if (currentProvider === 'local') {
                const endpoint = document.getElementById('endpointInput').value;
                isConfigured = endpoint && endpoint.trim() !== '';
                statusText = isConfigured ? 'Local endpoint configured' : 'Local endpoint required';
            } else {
                const apiKey = document.getElementById('apiKeyInput').value;
                isConfigured = apiKey && apiKey.trim() !== '';
                statusText = isConfigured ? `${currentProvider} API key configured` : 'API key required';
            }
            
            statusEl.textContent = statusText;
            statusEl.className = `settings-status ${isConfigured ? 'success' : ''}`;
            saveBtn.disabled = !isConfigured;
            
            // Show/hide analyze button based on saved settings
            const savedSettings = localStorage.getItem('aiPaperAnalysis_settings');
            if (savedSettings && isConfigured) {
                analyzeBtn.classList.remove('hidden');
            } else {
                analyzeBtn.classList.add('hidden');
            }
        }
        
        function updateKeyPreview() {
            const apiKey = document.getElementById('apiKeyInput').value;
            const preview = document.getElementById('keyPreview');
            
            if (apiKey && apiKey.length > 8) {
                const masked = apiKey.substring(0, 6) + '‚Ä¢'.repeat(Math.min(apiKey.length - 6, 20));
                preview.textContent = masked;
            } else {
                preview.textContent = '';
            }
        }
        
        function showSettingsStatus(message, type) {
            const statusEl = document.getElementById('settingsStatus');
            statusEl.textContent = message;
            statusEl.className = `settings-status ${type}`;
        }
        
        // Event listeners for settings
        document.getElementById('apiKeyInput').addEventListener('input', () => {
            updateKeyPreview();
            updateSettingsStatus();
        });
        
        document.getElementById('endpointInput').addEventListener('input', updateSettingsStatus);
        
        // Close modal on backdrop click
        document.getElementById('settingsModal').addEventListener('click', (e) => {
            if (e.target.id === 'settingsModal') {
                closeSettings();
            }
        });
        
        // Keyboard shortcuts for settings
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !document.getElementById('settingsModal').classList.contains('hidden')) {
                closeSettings();
            }
        });
        
        // Analysis Management
        async function runAnalysis() {
            const analyzeBtn = document.getElementById('analyzeButton');
            const statusEl = document.getElementById('settingsStatus');
            
            // Get saved settings
            const savedSettings = localStorage.getItem('aiPaperAnalysis_settings');
            if (!savedSettings) {
                showSettingsStatus('Please configure API settings first', 'error');
                return;
            }
            
            const settings = JSON.parse(savedSettings);
            
            // Update button state
            analyzeBtn.disabled = true;
            analyzeBtn.classList.add('running');
            analyzeBtn.innerHTML = 'üîÑ Analyzing...';
            
            try {
                // Show progress
                showSettingsStatus('Starting analysis pipeline...', 'success');
                
                // Call analysis API
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        provider: settings.provider,
                        apiKey: settings.apiKey,
                        endpoint: settings.endpoint
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showSettingsStatus(`Analysis complete! Processed ${result.papers_processed} papers`, 'success');
                    
                    // Refresh the paper list and current paper
                    await loadPapers();
                    renderPapers();
                    
                    // Refresh current paper if one is selected
                    if (currentPaper) {
                        await loadPaperContent(currentPaper);
                    }
                    
                    // Auto-close settings modal after a delay
                    setTimeout(() => {
                        closeSettings();
                    }, 2000);
                    
                } else {
                    const error = await response.json();
                    showSettingsStatus(`Analysis failed: ${error.message}`, 'error');
                }
                
            } catch (error) {
                console.error('Analysis error:', error);
                showSettingsStatus('Analysis failed: Network error', 'error');
            } finally {
                // Reset button state
                analyzeBtn.disabled = false;
                analyzeBtn.classList.remove('running');
                analyzeBtn.innerHTML = 'üîÑ Re-analyze Papers';
            }
        }
        
        // Initialize the application
        init();
    </script>
</body>
</html>